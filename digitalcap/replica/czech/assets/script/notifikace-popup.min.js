var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),__awaiter=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))(function(i,s){function r(t){try{p(o.next(t))}catch(t){s(t)}}function a(t){try{p(o.throw(t))}catch(t){s(t)}}function p(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(r,a)}p((o=o.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var n,o,i,s,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=o[2&s[0]?"return":s[0]?"throw":"next"])&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[0,i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(i=(i=r.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){r=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(6===s[0]&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(t){s=[6,t],o=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};!function(){var t,e,n=function(){return function(t){this.key=t}}(),o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.read=function(){var t=this;return window.GlobalStorage?new Promise(function(e){window.GlobalStorage.read(t.key,function(t){e(t.length?t:void 0)})}):Promise.reject("No GlobalStorage present")},e.prototype.write=function(t){var e=this;return window.GlobalStorage?new Promise(function(n,o){window.GlobalStorage.write(e.key,t,function(t){t?n():o(t)})}):Promise.reject("No Globalstorage present")},e}(n),i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.write=function(t){return window.localStorage?(window.localStorage[this.key]=t,Promise.resolve()):Promise.reject("No Localstorage present")},e.prototype.read=function(){return window.localStorage?Promise.resolve(window.localStorage[this.key]):Promise.reject("No Localstorage present")},e}(n);(e=t||(t={})).enabled="enabled",e.disabled="disabled",e.undecided="undecided";var s={sport:["sport.idnes.cz","fotbal.idnes.cz","hokej.idnes.cz","oh.idnes.cz"],expres:["www.expres.cz","expres.cz"],ocko:["ocko.tv","www.ocko.tv"],zpravy:["zpravy.idnes.cz"],local:["localhost","1gr.cz"]},r=function(){function e(e){var n=this;if(this.host=window.location.host,this.isHost(s.expres))this.storage=new i("notifikace-popup-expres");else if(this.isHost(s.ocko))this.storage=new i("notifikace-popup-ocko");else if(this.isHost(s.local))this.storage=new i("notifikace-popup-local");else if(this.isHost(s.sport))this.storage=new o("notifikace-popup-sport");else{if(!this.isHost(s.zpravy))return void console.log("Notifications: unknown host: "+this.host);this.storage=new o("notifikace-popup")}this.parentNode=e||document.body,this.createDOM(),window.addEventListener("message",function(t){"notification-result"===t.data.type&&n.onPromptResult(t.data.status,t.data.error)}),this.persistentState={notificationsDecision:t.undecided,lastQuery:Date.now(),queryCount:0}}return e.prototype.onYesClick=function(){var t=this;this.yesButton.classList.add("disabled"),this.log("preliminary-success"),window.onNotificationRegistrationComplete=function(e,n){e?t.onPromptResult("success"):t.onPromptResult("error",n)};var e=document.createElement("script");e.src=this.isHost(s.local)?"./notifikace.js?v=13":"https://1gr.cz/js/notifikace/notifikace.min.js",e.async=!0,e.addEventListener("error",function(){alert("Je nám líto, ale povolení notifikací selhalo, pravděpodobně jste odpojeni od internetu. Zkuste to prosím později."),t.hide()}),this.element.appendChild(e)},e.prototype.run=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.getShouldBeDisplayed()];case 1:return t.sent()&&this.display(),[2]}})})},e.prototype.onNoClick=function(){this.persistentState.notificationsDecision=t.disabled,this.savePersistentState(),this.log("hide"),this.hide()},e.prototype.onPromptResult=function(e,n){this.hide(),"success"===e?(this.log("final-success"),this.persistentState.notificationsDecision=t.enabled,this.savePersistentState()):(this.log("final-fail"),alert("Je nám líto, ale povolení notifikací se nezdařilo, zkuste to prosím později.\n"+n))},e.prototype.getVariant=function(){var t=[];return this.isHost(s.sport)?(t.push({question:"Nejdůležitější sportovní zprávy na vašem monitoru",yesAnswer:"Povolit",noAnswer:"Nepovolit"}),this.variantId="sport"):this.isHost(s.expres)?(t.push({question:"Chci mít každý den nejdůležitější zprávy ve svém prohlížeči!",yesAnswer:"ANO",noAnswer:"Ne, děkuji"}),this.variantId="expres"):this.isHost(s.ocko)?(t.push({question:"Chci mít každý den žhavé novinky, soutěže a zajímavosti ve svém prohlížeči",yesAnswer:"ANO",noAnswer:"Ne, děkuji"}),this.variantId="ocko"):this.isHost(s.local)?(t.push({question:"Lokál.",yesAnswer:"ANO",noAnswer:"Ne, děkuji"}),this.variantId="ocko"):(t.push({question:"Nejdůležitější zprávy na vašem monitoru",yesAnswer:"Povolit",noAnswer:"Nepovolit"}),this.variantId="idnes"),t[0]},e.prototype.display=function(){this.log("display"),this.parentNode.appendChild(this.element)},e.prototype.hide=function(){this.parentNode.removeChild(this.element)},e.prototype.getShouldBeDisplayed=function(){return __awaiter(this,void 0,void 0,function(){var e,n,o,i,r,a;return __generator(this,function(p){switch(p.label){case 0:return this.isHost(s.local)?[2,Promise.resolve(!0)]:[4,this.storage.read()];case 1:return void 0!==(e=p.sent())?(this.persistentState=JSON.parse(e),this.undecideOnExpresIfNotEnabledAndWeekOld(),this.persistentState.notificationsDecision!==t.undecided?(console.log("Notitications: not displaying, decision made: "+this.persistentState.notificationsDecision),[2,!1]):(n=new Date(this.persistentState.lastQuery),o=new Date,i=(o.getTime()-n.getTime())/864e5,r=!1,this.persistentState.queryCount<=3?(a=o.getDate()!==n.getDate(),(i>.25&&a||i>1)&&(console.log("Notifications: displaying, < 3 views, > 1 day"),r=!0)):i>7&&(r=!0,console.log("Notifications: displaying, > 1 week")),r?(this.persistentState.queryCount+=1,this.persistentState.lastQuery=Date.now(),this.savePersistentState()):console.log("Notitications: not displaying, under timeout"),[2,r])):(this.persistentState={notificationsDecision:t.undecided,lastQuery:Date.now(),queryCount:0},console.log("Notitications: not displaying, new"),this.savePersistentState(),[2,!1])}})})},e.prototype.undecideOnExpresIfNotEnabledAndWeekOld=function(){this.isHost(s.expres)&&this.persistentState.notificationsDecision!==t.enabled&&this.persistentState.lastQuery<Date.now()-6048e5&&(this.persistentState.notificationsDecision=t.undecided,this.persistentState.queryCount=0)},e.prototype.isHost=function(t){return t.indexOf(window.location.host)>=0},e.prototype.savePersistentState=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.storage.write(JSON.stringify(this.persistentState)),[2]})})},e.prototype.log=function(t){var e="notifikace-"+this.variantId+"-"+t;window.Log&&window.Log.ping(window.location.toString(),e)},e.prototype.createDOM=function(){var t=this;this.element=document.createElement("div"),this.element.id="notifikace-popup";var e=this.getVariant();this.element.innerHTML="<b>"+e.question+'</b>\n                <div class="buttons"></div>',this.yesButton=document.createElement("a"),this.yesButton.setAttribute("disabled","disabled"),this.yesButton.href="#",this.yesButton.className="yes-button",this.yesButton.innerHTML=e.yesAnswer,this.yesButton.addEventListener("click",function(e){e.preventDefault(),t.onYesClick()}),this.noButton=document.createElement("a"),this.noButton.href="#",this.noButton.className="no-button",this.noButton.innerHTML=e.noAnswer,this.noButton.addEventListener("click",function(e){e.preventDefault(),t.onNoClick()});var n=this.element.querySelector(".buttons");n.appendChild(this.noButton),n.appendChild(this.yesButton);var o=document.createElement("style"),i=this.isHost(s.expres)?"https://1gr.cz/u/favicon/apple-touch-icon/expres.png":this.isHost(s.ocko)?"https://1gr.cz/u/favicon/apple-touch-icon/ocko.png":"https://1gr.cz/u/favicon/apple-touch-icon.png";o.innerHTML="\n            #notifikace-popup {\n                position: fixed;\n                top: 0;\n                left: 50%;\n                transform: translate(-50%, 0);\n                background: white;\n                border-bottom-left-radius: 3px;\n                border-bottom-right-radius: 3px;\n                padding: 20px 20px;\n                font-size: 14px;\n                color: #666666;\n                font-family: Roboto, 'Fira Sans', helvetica, arial, sans-serif;\n                box-shadow: 0 2px 6px rgba(0,0,0,0.2);\n                line-height: 1.5em;\n                text-align: left;\n                z-index: 9999;\n                cursor: auto;\n                width: calc(100% - 60px);\n                max-width: 500px;\n            }\n            @media screen and (max-width: 1023px) {\n                #notifikace-popup {\n                    top: auto;\n                    bottom: 0;\n                    box-shadow: 0 -2px 6px rgba(0,0,0,0.2);\n                    border-radius: 0;\n                    border-top-left-radius: 3px;\n                    border-top-right-radius: 3px;\n                }\n            }\n            #notifikace-popup::before {\n                content: \"\";\n                position: absolute;\n                top: 20px;\n                left: 20px;\n                background: transparent url('"+i+"');\n                background-size: contain;\n                width: 80px;\n                height: 80px;\n            }\n            #notifikace-popup > b, #notifikace-popup > span {\n                display: block;\n                padding-left: 100px;\n            }\n            #notifikace-popup > b {\n                text-transform: uppercase;\n                font-weight: normal;\n            }\n            @media screen and (max-width: 400px) {\n                #notifikace-popup > b {\n                    min-height: 84px;\n                }\n            }\n            #notifikace-popup .buttons {\n                float: right;\n                margin-top: 1.5em;\n                width: 100%;\n                max-width: 280px;\n            }\n            #notifikace-popup .buttons a {\n                display: block;\n                float: left;\n                text-align: center;\n                text-transform: uppercase;\n                text-decoration: none;\n                color: #4285f4;\n                border-radius: 3px;\n                width: calc(50% - 10px);\n            }\n            #notifikace-popup .buttons a.no-button {\n                padding: 10px 0;\n            }\n            #notifikace-popup .buttons a.no-button:hover {\n                text-decoration: underline;\n            }\n            #notifikace-popup .buttons a.yes-button {\n                padding: 10px 0;\n                margin-left: 20px;\n                background-color: #1976D2;\n                color: white;\n                box-shadow: 0 3px 5px rgba(0,0,0,0.2);\n            }\n            #notifikace-popup .buttons a.yes-button.disabled {\n                background-color: #eee;\n                color: #222;\n            }\n            #notifikace-popup .buttons a.yes-button:hover {\n                background-color: #1E88E5;\n            }\n            #notifikace-popup .buttons a.yes-button:active {\n                background-color: #0D47A1;\n            }\n            #notifikace-popup iframe {\n                width: 0;\n                height: 0;\n                visibility: hidden;\n            }\n            ",document.head.appendChild(o)},e}();"serviceWorker"in navigator&&"Notification"in window&&"default"===window.Notification.permission&&(window.notifikacePopup=(new r).run())}();